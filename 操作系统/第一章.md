# 第一章 操作系统引论
## 1.1 操作系统的目标和作用
### 1.1.1 操作系统的目标
1. 方便性
2. 有效性
3. 可扩充性
4. 开放性
### 1.1.2 操作系统的作用
1. OS作为用户与计算机应将系统之间的接口  
    含义：OS处于用户与计算机硬件系统之间，用户通过OS来使用计算机系统  
    用户通过**命令方式**、**系统调用方式**、**图标-窗口方式**来实现与操作系统的通信
2. OS作为计算机系统资源的管理者  
    资源类别：处理机、存储器、I/O设备、文件  
    处理机管理：用于分配和控制处理机  
    存储器管理：负责内存的分配与回收  
    I/O设备管理：负责I/O设备的分配与操纵  
    文件管理：用于实现对文件的存取、共享、保护
3. OS实现对计算机资源的抽象  
    通过I/O软件隐藏I/O对于硬件接口的操作细节  
    覆盖了I/O软件的机器成为扩充机器或虚机器  
    I/O软件上覆盖文件管理软件，文件管理软件覆盖窗口软件  
    OS时铺设在计算机硬件上的多层软件的集合
### 1.1.3推动操作系统发展的主要动力
1. 不断提高的计算机资源利用率
2. 方便用户
3. 器件的不断更新迭代
4. 计算机体系结构的不断发展
5. 不断提出新的应用需求
## 1.2操作系统的发展过程
### 1.2.1未配置操作系统的计算机系统
1. 人工操作方式：  
    缺点：  
    1.用户独占全机  
    2.CPU等待人工操作  
    人工操作方式严重降低了计算机资源的利用率，产生了人机矛盾，
    CPU与I/O设备的速度不匹配。  
    为解决人机矛盾，产生了通道技术、缓冲技术，不能理想解决。

2. 脱机输入/输出(Off-Line I/O)方式  
    通过外围机和外存提前存储信息，CPU使用时，从外存中高速调入内存。  
    优点：  
    1.减少了CPU的空闲时间。  
    2.提高了I/O速度
### 1.2.2 单道批处理系统
1. 单道批处理系统的处理过程：  
    1.将处理的所有作业预先以脱机的方式输入到磁带。  
    2.监督程序将磁带上的第一个作业装入内存，将运行控制权交给该作业  
    3.当改作业处理完成时，控制权归还监督程序，监督程序重复1步骤，直至全部作业处理完  
    **虽然对作业的处理时成批进行的，但是内存中始终只存在一道作业**
2. 优缺点：  
    1.减少了人工操作的时间，提高机器的利用率和系统吞吐量。  
    2.系统中的资源特不到充分利用；CPU等待I/O完成后才继续运行；CPU的利用率手I/O速度的限制。
3. 特点：自动、顺序、单道
### 1.2.3 多道批处理系统
1. 基本概念：
    1.作业预先存在外存，形成后备队列
    2.作业调度程序，按照算法选择若干程序调入内存，共享CPU和系统资源。
    3.在进行I/O操作时，调度其他程序，使得CPU不空闲
2. 特点：  
    1.多道性  
    2.无序性  
    3.调度性
3. 优缺点：  
    1.资源利用率高  
    2.系统吞吐量大
    3.平均运转时间长
    4.无交互能力
4. 需要解决的问题：  
    1.处理机争用问题  
    2.内存分配和保护问题  
    3.I/O设备分配问题  
    4.文件的组织和管理问题  
    5.作业管理问题  
    6.用户与系统的接口问题  
    基于以上问题产生了操作系统。
### **操作系统的定义：**  
**操作系统是一组能够有效地组织和管理计算机硬件和软件资源，合理地对各类作业进行调度，以及方便用户使用地程序的集合**

### 1.2.4分时系统(Time Sharing System)
产生：基于需求  
    人-机交互、共享主机、便于用户上机  

**分时系统的定义**：在一台主机上连接了多个配有显示器和键盘的终端并由此锁组成的系统，该系统允许多个用户同时通过自己的终端，以交互的方式使用计算机，共享主机中的资源

基本思想：让多个用户同时通过终端使用系统，而OS则在系统内部按一定策略调度和处理用户程序。  
* 多道批处理系统和分时系统都使用了多道程序设计技术，但侧重点不同。

关键问题：  
1. 及时接收：配置多路卡，实现分时多路复用
2. 及时处理：作业直接进入内存；采用轮转运行方式


特征：多路性、独立性、及时性、交互性

### 1.2.5实时系统
定义：指系统能及时（或即时）响应外部事件的请求，在规定的时间内完成对该事件的处理，并控制所有实时任务协调一致地运行。

实时操作系统的应用领域：  
有实时要求（有严格确定的时间限制）的领域（过程控制及事务处理）--多道批处理系统和分时系统不能满足

类型：（1）实时控制系统 （2）实时信息处理系统（3）多媒体系统 （4）嵌入式系统

实时任务类型：  
周期性/非周期性实时任务（截止时间）  
硬实时任务/软实时任务

实时系统与分时系统特征的比较：  
多路性、独立性、及时性、交互性、可靠性

## 1.3操作系统的基本特性
并发、共享、虚拟、异步
### 1.3.1并发
1. 基本概念  
* 指在计算机系统中同时存在着多道运行的程序（进程）  
宏观上：多道程序同时在执行  
微观上：任何时刻只有一道程序在执行，即微观上多道程序在CPU上轮流（交替）执行（单机）  
* 并行(parallel)： 与并发相似，指多道程序在同一时刻执行，但需多个硬件支持。
2. 引入进程：  
程序和进程：在多道程序系统中，程序不能独立运行，更不能和其它程序并发执行。引入进程的目的，就是为了使多个程序并发执行。  
引入线程：  
进程是OS中拥有资源并独立运行的基本单位。引入线程后，把进程作为分配资源的基本单位，把线程作为独立运行和独立调度的基本单位，进一步提高系统的并发性。
> * 程序的并发执行能有效改善系统资源的利用率，但使系统复杂化，因此操作系统必须对并发活动进行控制和管理。
> * 并发是操作系统最重要的特征，其它特征均以并发为前提。

### 1.3.2共享
指系统中的资源不再为某道程序所独占，而是供多道程序共同使用。

* 资源共享方式：  
    互斥共享方式  
    同时访问方式

* **并发和共享是操作系统的两个最基本的特征**，二者互为存在条件：  
    资源的共享是以程序（进程）的并发执行为条件。  
    程序的并发执行也以资源的共享为条件。

### 1.3.3虚拟
通过某种技术把一个物理实体映射为若干个对应的逻辑实体——分时（时分复用技术）或分空间（空分复用技术）。

虚拟是操作系统管理系统资源的重要手段，可提高资源利用率。

### 1.3.4异步
也称不确定性，指进程在执行中，其执行时间、顺序、向前推进的速度和完成的时间等都是不可预知的。

只要在OS中配置有完善的进程同步机制，且运行环境相同，作业经多次运行都会获得完全相同的结果。所以，异步运行方式是允许的，是OS的一个重要特征。

## 1.4操作系统的主要功能
处理机管理、存储器管理、设备管理、文件管理、接口管理
### 1.4.1 处理及管理功能
* 主要任务：  
    对处理机进行分配  
    对处理机运行进行有效的控制和管理

* 功能：  
    进程控制  
    进程同步  
    进程通信  
    调度 

### 1.4.2存储器管理功能
* 主要任务：  
    为多道程序的运行提供良好的环景  
    方便用户使用存储器  
    提高存储器的利用率  
    从逻辑上扩充内存 
* 功能：  
    内存分配（静态分配、动态分配）  
    内存保护  
    地址映射  
    内存扩充  

### 1.4.3 设备管理功能
* 主要任务：  
完成用户提出的I/O请求  
为用户分配I/O设备  
提高I/O设备的利用率及速度  
方便用户使用I/O设备
* 功能：  
缓冲管理  
设备分配  
设备处理  
虚拟设备

### 1.4.5文件管理功能
* 主要任务：  
对用户文件和系统文件进行管理  
方便用户使用文件  
保证文件的安全性
* 功能：  
文件存储空间的管理  
目录管理  
文件的读、写管理和保护

### 1.4.5OS与用户之间的接口
* 主要任务：方便用户使用操作系统
* 功能：  
用户接口（联机用户接口-命令方式、图形用户接口，脱机用户接口）  
程序接口（系统调用）

### 1.4.6现代操作系统的新功能
系统安全、网络的功能和服务、支持多媒体

## 1.5 操作系统的结构设计
操作系统的结构设计经历了以下几代：
* 传统的操作系统结构
    * 无结构操作系统
    * 模块化结构OS
    * 分层式结构OS
* 客户/服务器模式
* 面向对象的程序设计
* 微内核OS结构

### 1.5.1传统操作系统结构
1. 无结构操作系统  
 OS是由众多的过程直接构成，各过程之间可相互调用，但OS内部不存在任何结构，所以这种OS是无结构的，又称为整体系统结构。  
    缺点：
    既庞大又杂乱，缺乏清晰的程序结构；程序错误多，调试难、阅读难、理解难、维护难。

2. 模块化结构OS  
    OS是采用“模块化程序设计”技术，按其功能划分为若干个独立的模块，管理相应的功能，同时规定好各模块之间的接口，以实现它们的交互，对较大模块又可按子功能进一步细分下去。所以这种OS称为模块化OS结构。  

    模块独立性：  
    * 关键：模块的划分和规定好模块之间的接口  
    * 衡量独立性的两个标准：
        * 内聚性：指模块内部各部分间联系的紧密程度  
        * 耦合度：指模块间相互联系和相互影响的程度
    
    优点：  
    * 提高了OS设计的正确性、可理解性和可维护性
    * 增强了OS的可适用性
    * 加速了OS的开发过程

    缺点：  
    * 模块及接口划分较困难  
    * 未区别共享资源和独占资源  
    * 由于管理上的差异，使OS结构变得不够清晰
3. 分层式结构OS  
分层式结构是对模块化结构的一种改进，它按分层式结构设计的基本原则，将OS 划分为若干个层次，每一层都只能使用其底层所提供的功能和服务，从硬件开始，在其上面一层一层地自底向上增添相应功能的软件，这种OS结构称为分层式OS结构。

    特点：  
    * 每一步设计都建立在可靠的基础上，结构更清晰
    * 调试和验证更容易，正确性更高

    分层式结构的优点：  
    * 易保证系统的正确性  
    * 易扩充和易维护  
    
    缺点：  
    * 系统效率降低

### 1.5.2客户/服务器模式  
客户/服务器模式的组成：  
* 客户机：每台客户机都是一个自主计算机，客户进程在运行
* 服务器：一台规模较大的机器，为网上所有的用户提供一种或多种服务。
* 网络系统：用于连接所有客户机和服务器，实
现它们之间的通信和网络资源共享。

客户/服务器之间的交互：
* 客户发送请求消息、服务器接收消息
* 服务器回送消息、客户机接收消息

客户/服务器模式的优点：
* 数据的分布处理和存储
* 便于集中管理
* 灵活性和可扩充性
* 易于改编应用软件

不足之处：
* 存在着不可靠性和瓶颈问题
* 改进方法：在网络中配置多个服务器，并采取相应的安全措施。

### 1.5.3面向对象的程序设计
面向对象技术的基本概念：
* 对象
* 类
* 继承

面向对象技术的优点：
* 通过“重用”提高产品质量和生产率。
* 使系统具有更好的易修改性和易扩展性。
* 更易于保证“正确性”和“可靠性

### 1.5.4 微内核OS结构
微内核技术的主要思想：  
在OS内核中只留下一些最基本的功能，而将其他服务分离出去，由工作在用户态下的进程来实现，形成“客户/服务器”模式。客户进程可通过内核向服务器进程发送请求，以取得OS的服务。

微内核：  
精心设计的，能实现现代OS核心功能的小型内核，它小而精炼，运行在核心态下，开机后常驻内存，不会因内存紧张而换出，它为构建通用OS提供了一个重要基础。

微内核OS的基本概念：  
在进行现代OS结构设计时，大多采用基于客户/服务器模式的微内核结构，将OS分为两部分：微内核和多个服务器。
* 足够小的内核
* 基于客户/服务器模式
* 应用“机制与策略分离”原理
* 采用面向对象技术

微内核的基本功能：  
1. 进程（线程）管理
2. 低级存储器管理
3. 中断和陷入处理

优点：  
微内核OS结构是建立在模块化、层次化结构的基础上的，并采用了C/S模式和OO的程序设计技术。  
* 提高了系统的可扩展性
* 增强了系统的可靠性
* 提供了对分布式系统的支持
* 融入了面向对象技术

缺点：  
相比早期的操作系统。降低了运行效率，同时提升了设计难度。

